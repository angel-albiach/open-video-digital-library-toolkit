- title ||= Library.title
- my ||= Library.my
!!!
%html{ :xmlns => "http://www.w3.org/1999/xhtml" }
  %head
    %title= title
    = stylesheet_link_tag :all, :cache => "cached"
    = javascript_include_tag :all, :cache => "cache/all"
    = javascript_tag "var AUTH_TOKEN = #{form_authenticity_token.inspect};" |
      if protect_against_forgery? |
    = javascript_tag "var relative_url_root = '#{ActionController::Base.relative_url_root}'"
  %body
    .wrapper
      .center
        .superheader
          .login_out
            - if logged_in?
              .button= link_to "Logout", logout_path
            - else
              .button= link_to "Login", login_path, { :rel => "facebox" }
            -#
              .user
                You're logged in as
                %span.login= h current_user.login
          - if !logged_in?
            .register
              .button= link_to "Register", signup_path, { :rel => "facebox" }
          - if current_user and current_user.has_role?( "admin" )
            .admin
              .button= link_to "Administration", library_path
        /superheader end, div.header start
        .header
          .logo
            %h1
              = link_to title, url_for( :controller => :home, :action => :index )
            %h2
              .subtitle= Library.subtitle

          .navigation
            %ul
              %li{:class => ( HomeController === controller ? "on" : "off")}
                .text= link_to "HOME", url_for( :controller => :home, :action => :index ) |
                .flag
              %li{:class => ( VideosController === controller ? "on" : "off")}
                .text= link_to "VIDEOS", videos_path
                .flag
              %li{:class => collections_flag }
                .text= link_to "COLLECTIONS", collections_collections_path
                .flag
              %li{:class => playlists_flag }
                .text= link_to "PLAYLISTS", playlists_collections_path |
                .flag
              - if current_user
                %li{:class => ( MyController === controller ? "on" : "off")}
                  .text= link_to h(my), my_path
                  .flag
            .search
              %form#new_search.new_search{ :action => "", :method => "get" }
                %input.input-text{ :name => "search[criteria][text][]", :size => "40", :type => "text" }
                %input.btn{ :src => "images/sch.gif", :type => "image" }
        /header end
        .container
          = yield
    .footer
      .center
        %ul
          %li
            = link_to "Home", url_for( :controller => :home, :action => :index )
          %li
            |
          %li
            = link_to "About", url_for( :controller => :home, :action => :about )
          %li
            |
          %li
            = link_to "Contact", url_for( :controller => :home, :action => :contact )
          %li
            |
          %li
            = link_to "News", url_for( :controller => :home, :action => :news )
          %li
            |
          %li
            = link_to "Privacy Policy &amp; Terms of Use", |
              url_for( :controller => :home, :action => :privacy ) |
        .copyright
          :textile
            #{@library.copyright}
        Powered by the
        = link_to "Open Video Toolkit", "http://www.open-video-toolkit.org/"
        /div.container end
      /div.center end
    /div.wrapper end
    -# after a page loads, immediately highlight any flash messages (changes bg to yellow, then fade back to white)
    -# a little later, fade out and remove the message completely
    :javascript
      $(document).ready( function() {
        setTimeout( '$(".flash").effect("highlight", {}, 1000 );', 500 );
        setTimeout( '$(".flash.notice").fadeOut( 2000 );' , 2000 );
        $('a[rel*=facebox]').facebox({opacity:0.5})
      } );
